name: SendToChannelEitaa

on:
  workflow_dispatch:
  schedule:
    - cron: "30 5,8,11,14,17,20 * * *"

jobs:
  sendZip:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Create directories
        run: |
          mkdir -p Protocols
          mkdir -p Country
          mkdir -p NetworkType

      - name: Move specific files
        run: |
          mv category/vless.txt category/ss.txt category/trojan.txt category/vmess.txt category/wireguard.txt Protocols
          mv category/httpupgrade.txt category/ws.txt category/xhttp.txt category/tcp.txt category/grpc.txt NetworkType
          mv category/* Country

      - name: Zip the files
        run: |
          zip -r v2rayng_free.zip Protocols Country NetworkType

      - name: Send ZIP to API
        run: |
          CAPTION=$'🆕 آخرین لیست بروزرسانی شده\n\n#v2ray #vmess #vless\n\n@v2rayng_free | مارا به دوستان خود معرفی کنید'
          
          curl -X POST "https://eitaayar.ir/api/bot${{ secrets.PERSONAL_API_KEY }}/sendFile" \
            -F "chat_id=v2rayng_free" \
            -F "file=@v2rayng_free.zip" \
            -F "caption=$CAPTION"
